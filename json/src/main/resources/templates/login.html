<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Вход</title>

    <!-- Bootstrap 5 CDN -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet">

    <style>
        body{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f8f9fa;}
        .card{width:100%;max-width:420px;}
    </style>
</head>
<body>
<div class="card shadow-lg rounded-4 p-4">
    <h3 class="text-center mb-4">Авторизация</h3>
    <form id="loginForm">
        <div class="mb-3">
            <label for="username" class="form-label">Логин</label>
            <input type="text" class="form-control" id="username" required autofocus>
        </div>

        <div class="mb-4">
            <label for="password" class="form-label">Пароль</label>
            <input type="password" class="form-control" id="password" required>
        </div>

        <button type="submit" class="btn btn-primary w-100">Войти</button>
        <div id="error" class="text-danger mt-3 d-none">Неверные учетные данные</div>
    </form>
</div>

<script>
    const form = document.getElementById('loginForm');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const body = {
            username: document.getElementById('username').value.trim(),
            password: document.getElementById('password').value.trim()
        };

        try {
            const resp = await fetch('/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });

            if (!resp.ok) {
                document.getElementById('error').classList.remove('d-none');
                return;
            }

            const data = await resp.json();                 // <-- AuthenticationResponseDto
            // предполагаем поля accessToken / refreshToken
            localStorage.setItem('access_token', data.accessToken || data.token);
            localStorage.setItem('refresh_token', data.refreshToken || data.refreshToken);
            window.location.href = '/view/enterprises';          // контроллер-view, возвращающий enterprises.html
        } catch (err) {
            console.error(err);
            alert('Ошибка сервера. Попробуйте позже.');
        }
    });
</script>
</body>
</html>
